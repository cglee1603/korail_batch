# 사용 예시

## 예시 1: 기본 사용

### 시나리오
매일 오전 10시에 특정 엑셀 파일을 처리하여 RAGFlow에 업로드

### 설정 (.env)
```env
RAGFLOW_API_KEY=ragflow-I0NmRjMWNhMDk3ZDExZjA5NTA5MDI0Mm
RAGFLOW_BASE_URL=http://localhost:9380
EXCEL_FILE_PATH=./data/ktx_documents.xlsx
BATCH_SCHEDULE=10:00
```

### 실행
```powershell
cd rag_batch
python main.py
```

### 결과
- 매일 10시에 자동 실행
- 엑셀 시트별로 지식베이스 생성
- 하이퍼링크된 파일 자동 다운로드 및 업로드
- `logs/batch_YYYYMMDD.log`에 처리 내역 기록

---

## 예시 2: 수동 1회 실행

### 시나리오
테스트 또는 즉시 처리가 필요한 경우

### 실행
```powershell
cd rag_batch
python main.py --once --excel "C:\Documents\2025_maintenance_manual.xlsx"
```

### 결과
- 지정된 파일을 즉시 처리
- 스케줄 설정 무시
- 처리 완료 후 종료

---

## 예시 3: 다중 시트 처리

### 엑셀 파일 구조
```
파일명: ktx_documents.xlsx
시트:
  1. KTX-EMU 유지보수 매뉴얼
  2. KTX-EMU 의주수선점검서
  3. 기술문서
```

### 처리 결과
```
생성된 지식베이스:
  1. "KTX-EMU 유지보수 매뉴얼" (15개 문서)
  2. "KTX-EMU 의주수선점검서" (8개 문서)
  3. "기술문서" (23개 문서)
```

### 로그 예시
```
2025-05-15 10:00:00 - INFO - 배치 프로세스 시작
2025-05-15 10:00:01 - INFO - 엑셀 파일 로드 완료: data/ktx_documents.xlsx
2025-05-15 10:00:02 - INFO - 총 3개 시트 발견: ['KTX-EMU 유지보수 매뉴얼', 'KTX-EMU 의주수선점검서', '기술문서']
2025-05-15 10:00:03 - INFO - ============================================================
2025-05-15 10:00:03 - INFO - 시트 처리 시작: KTX-EMU 유지보수 매뉴얼
2025-05-15 10:00:03 - INFO - ============================================================
2025-05-15 10:00:04 - INFO - 헤더 행 감지: 1행 (비어있지 않은 셀: 12개)
2025-05-15 10:00:04 - INFO - 헤더: ['구분', '자성보고', '관리번호', '제목', 'WBS(4)', ...]
2025-05-15 10:00:05 - INFO - 새 지식베이스 생성: KTX-EMU 유지보수 매뉴얼
2025-05-15 10:00:06 - INFO - 파일 다운로드 시작: file:///path/to/document1.pdf
2025-05-15 10:00:07 - INFO - 파일 복사 완료: C:\path\to\document1.pdf -> data/downloads/document1.pdf
2025-05-15 10:00:08 - INFO - PDF 파일 - 변환 없이 사용: document1.pdf
2025-05-15 10:00:09 - INFO - 메타데이터 - document1.pdf:
2025-05-15 10:00:09 - INFO -   구분: 설계
2025-05-15 10:00:09 - INFO -   자성보고: K20
2025-05-15 10:00:09 - INFO -   관리번호: 002
2025-05-15 10:00:09 - INFO -   제목: KTX-이름 경정비
2025-05-15 10:00:10 - INFO - 파일 업로드 시작: document1.pdf
2025-05-15 10:00:11 - INFO - 파일 업로드 완료: document1.pdf
2025-05-15 10:00:12 - INFO - 파일: document1.pdf - 업로드 성공 (형식: pdf, 행: 5)
...
2025-05-15 10:05:30 - INFO - 시트 처리 완료: KTX-EMU 유지보수 매뉴얼 (파일 수: 15)
2025-05-15 10:05:30 - INFO - 시트 'KTX-EMU 유지보수 매뉴얼': 15개 파일 업로드 완료, 일괄 파싱 시작
2025-05-15 10:05:31 - INFO - 일괄 파싱 시작: KTX-EMU 유지보수 매뉴얼
...
```

---

## 예시 4: ZIP 파일 처리

### 엑셀 행 데이터
| 구분 | 제목 | 파일 |
|------|------|------|
| 설계 | 도면 패키지 | [링크](file:///path/to/drawings.zip) |

### ZIP 파일 내용
```
drawings.zip
├── drawing1.pdf
├── drawing2.pdf
├── drawing3.hwp
└── specs.txt
```

### 처리 과정
1. `drawings.zip` 다운로드
2. ZIP 압축 해제
3. 각 파일 처리:
   - `drawing1.pdf` → 그대로 업로드
   - `drawing2.pdf` → 그대로 업로드
   - `drawing3.hwp` → PDF 변환 후 업로드 (*스터브)
   - `specs.txt` → 그대로 업로드
4. 4개 문서가 지식베이스에 추가됨

### 로그
```
2025-05-15 10:10:00 - INFO - 파일 복사 완료: drawings.zip
2025-05-15 10:10:01 - INFO - ZIP 압축 해제 시작: drawings.zip
2025-05-15 10:10:02 - INFO - ZIP 압축 해제 완료: 4개 파일
2025-05-15 10:10:03 - INFO - PDF 파일 - 변환 없이 사용: drawing1.pdf
2025-05-15 10:10:04 - INFO - PDF 파일 - 변환 없이 사용: drawing2.pdf
2025-05-15 10:10:05 - WARNING - HWP->PDF 변환 기능은 현재 스터브입니다: drawing3.hwp
2025-05-15 10:10:06 - INFO - HWP->PDF 변환 완료: drawing3.pdf
2025-05-15 10:10:07 - INFO - TXT 파일 - 변환 없이 사용: specs.txt
```

---

## 예시 5: 숨김 행 제외

### 엑셀 시트
| 행 | 구분 | 제목 | 파일 | 상태 |
|----|------|------|------|------|
| 1 | (헤더) | | | |
| 2 | 설계 | 문서1 | [링크] | 표시 |
| 3 | 계획 | 문서2 | [링크] | **숨김** |
| 4 | 설계 | 문서3 | [링크] | 표시 |

### 처리 결과
- 2행: 처리됨 ✓
- 3행: **건너뜀** (숨김 처리됨)
- 4행: 처리됨 ✓

### 로그
```
2025-05-15 10:15:03 - DEBUG - 3행은 숨김 처리되어 건너뜁니다.
```

---

## 예시 6: 오류 처리

### 시나리오
일부 파일 다운로드 실패

### 로그
```
2025-05-15 10:20:05 - INFO - 파일 다운로드 시작: http://example.com/missing.pdf
2025-05-15 10:20:10 - ERROR - 파일 다운로드 실패 (http://example.com/missing.pdf): 404 Not Found
2025-05-15 10:20:10 - ERROR - 5행: 파일 가져오기 실패 - http://example.com/missing.pdf
2025-05-15 10:20:11 - INFO - 파일 다운로드 시작: file:///path/to/document2.pdf
2025-05-15 10:20:12 - INFO - 파일 복사 완료: document2.pdf
...
```

### 최종 통계
```
============================================================
배치 처리 통계
------------------------------------------------------------
처리된 시트 수: 3
생성된 지식베이스 수: 3
총 파일 수: 46
업로드 성공: 44
업로드 실패: 2
성공률: 95.7%
============================================================
```

---

## 예시 7: 주기적 실행 (5분마다)

### 설정
```env
BATCH_SCHEDULE=300
```

### 실행
```powershell
python main.py
```

### 동작
```
2025-05-15 10:00:00 - INFO - 스케줄 설정 완료: 300초마다 실행
2025-05-15 10:00:00 - INFO - 스케줄 대기 중... (Ctrl+C로 종료)
2025-05-15 10:00:01 - INFO - 배치 작업 시작 시간: 2025-05-15 10:00:01
...
2025-05-15 10:02:35 - INFO - 배치 작업 종료 시간: 2025-05-15 10:02:35
2025-05-15 10:02:35 - INFO - 총 소요 시간: 0:02:34
2025-05-15 10:05:01 - INFO - 배치 작업 시작 시간: 2025-05-15 10:05:01
...
```

---

## 예시 8: 메타데이터 활용

### 엑셀 데이터
| 구분 | 자성보고 | 관리번호 | 제목 | WBS(4) | 작성일자 | 담당자 | 파일 |
|------|---------|---------|------|--------|---------|--------|------|
| 설계 | K20 | 002 | 문서A | K20-5 | 2025-03-10 | 홍길동 | [링크] |

### 업로드된 메타데이터
```json
{
  "구분": "설계",
  "자성보고": "K20",
  "관리번호": "002",
  "제목": "문서A",
  "WBS(4)": "K20-5",
  "작성일자": "2025-03-10",
  "담당자": "홍길동",
  "원본_파일": "document.pdf",
  "파일_형식": "pdf",
  "엑셀_행번호": "5",
  "하이퍼링크": "file:///path/to/document.pdf"
}
```

### RAGFlow에서 활용
- 검색 필터링: "WBS(4) = K20-5"
- 작성자별 검색: "담당자 = 홍길동"
- 날짜별 검색: "작성일자 >= 2025-03-01"

---

## 예시 9: 여러 시간대 실행

### 설정
```env
BATCH_SCHEDULE=08:00,12:00,16:00
```

### 동작
```
2025-05-15 07:50:00 - INFO - 스케줄 설정 완료: 매일 08:00, 12:00, 16:00에 실행
2025-05-15 08:00:00 - INFO - 배치 작업 시작 시간: 2025-05-15 08:00:00
...
2025-05-15 12:00:00 - INFO - 배치 작업 시작 시간: 2025-05-15 12:00:00
...
2025-05-15 16:00:00 - INFO - 배치 작업 시작 시간: 2025-05-15 16:00:00
...
```

---

## 예시 10: Windows 시작 스크립트 사용

### PowerShell 스크립트
```powershell
# rag_batch 폴더에서 실행
.\start.ps1 --once --excel "C:\Documents\maintenance.xlsx"
```

### CMD 배치 파일
```cmd
cd C:\work\철도공사\ragplus\ragflow-plus\rag_batch
start.bat --once
```

### 작업 스케줄러 등록 (Windows)
1. 작업 스케줄러 열기
2. "기본 작업 만들기" 클릭
3. 이름: "RAGFlow 배치 프로세스"
4. 트리거: 매일 10:00
5. 동작: 프로그램 시작
   - 프로그램: `powershell.exe`
   - 인수: `-File "C:\work\철도공사\ragplus\ragflow-plus\rag_batch\start.ps1" --once`
6. 완료

이제 매일 자동으로 배치가 실행됩니다.

